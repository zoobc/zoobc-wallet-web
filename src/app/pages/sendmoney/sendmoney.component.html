<div class="sendmoney-container">
  <h2 class="mat-h2">{{ 'send money' | translate }}</h2>
  <mat-card>
    <form [formGroup]="formSend" (submit)="onOpenDialogDetailSendMoney()">
      <label>{{ 'sender' | translate }}</label>
      <account-selector (select)="onSwitchAccount($event)" type="normal"></account-selector>
      <input-address
        label="{{ 'recipient address' | translate }}"
        classList="block"
        formControlName="recipient"
        placeholder="{{ 'recipient address' | translate }}..."
        (change)="isAddressInContacts()"
      ></input-address>
      <ng-container *ngIf="recipientForm.touched">
        <mat-error *ngIf="recipientForm.hasError('required')">
          {{ 'recipient address is required' | translate }}
        </mat-error>
        <mat-error *ngIf="recipientForm.hasError('invalidAddress')">
          {{ 'zbc address is invalid' | translate }}
        </mat-error>
      </ng-container>
      <div class="address-alias" *ngIf="!showSaveAddressBtn">
        <span>{{ 'address' | translate }}: </span>
        <b>{{ contact.name }}</b>
      </div>
      <div style="margin-bottom: 8px;" *ngIf="showSaveAddressBtn">
        <mat-checkbox class="checkbox-margin" (change)="toggleSaveAddress()">
          {{ 'save to contact' | translate }}
        </mat-checkbox>
      </div>

      <ng-container *ngIf="saveAddress">
        <mat-form-field appearance="outline" color="accent" class="block">
          <mat-label>{{ 'name' | translate }}</mat-label>
          <input matInput type="text" formControlName="alias" placeholder="{{ 'name' | translate }}" />
        </mat-form-field>
        <ng-container *ngIf="aliasField.touched">
          <mat-error *ngIf="aliasField.hasError('required')">
            {{ 'name is required' | translate }}
          </mat-error>
        </ng-container>
      </ng-container>
      <input-amount
        [group]="formSend"
        typeCoinName="typeCoin"
        amountCurrencyName="amountCurrency"
        amountName="amount"
        [displayConverter]="true"
        [currencyRate]="currencyRate"
        label="{{ 'coin amount' | translate }}"
      >
      </input-amount>
      <div
        class="row"
        *ngIf="
          (amountForm.touched && amountForm.invalid) ||
          (amountCurrencyForm.touched && amountCurrencyForm.invalid)
        "
      >
        <div class="col-4 col-sm-3">&nbsp;</div>
        <div class="col-8 col-sm-9">
          <ng-container *ngIf="amountForm.touched && typeCoinField.value === 'ZBC'">
            <mat-error *ngIf="amountForm.hasError('required')">
              {{ 'amount is required' | translate }}
            </mat-error>
            <mat-error *ngIf="amountForm.hasError('min')">
              {{ 'minimum amount is' | translate: { val: '0.00000001' } }}
            </mat-error>
          </ng-container>
          <ng-container *ngIf="amountCurrencyForm.touched && typeCoinField.value === 'Fiat'">
            <mat-error *ngIf="amountCurrencyForm.hasError('required')">
              {{ 'amount is required' | translate }}
            </mat-error>
            <mat-error *ngIf="amountCurrencyForm.hasError('min')">
              {{ 'minimum amount in zbc must be zbc' | translate: { val: '0.00000001' } }}
            </mat-error>
          </ng-container>
        </div>
      </div>
      <input-amount
        [group]="formSend"
        typeCoinName="typeFee"
        amountCurrencyName="feeCurr"
        amountName="fee"
        [displayConverter]="true"
        [currencyRate]="currencyRate"
        label="{{ 'fee' | translate }}"
      >
      </input-amount>
      <div
        class="row"
        *ngIf="(feeForm.touched && feeForm.invalid) || (feeFormCurr.touched && feeFormCurr.invalid)"
      >
        <div class="col-4 col-sm-3">&nbsp;</div>
        <div class="col-8 col-sm-9">
          <ng-container *ngIf="feeForm.touched && typeFeeField.value === 'ZBC'">
            <mat-error *ngIf="feeForm.hasError('required')">
              {{ 'fee is required' | translate }}
            </mat-error>
            <mat-error *ngIf="feeForm.hasError('min')">
              {{ 'minimum fee is' | translate: { val: minFee } }}
            </mat-error>
          </ng-container>
          <ng-container *ngIf="feeFormCurr.touched && typeFeeField.value === 'Fiat'">
            <mat-error *ngIf="feeFormCurr.hasError('required')">
              {{ 'fee is required' | translate }}
            </mat-error>
            <mat-error *ngIf="feeFormCurr.hasError('min')">
              {{ 'minimum amount of fee in zbc must be zbc' | translate: { val: minFee } }}
            </mat-error>
          </ng-container>
        </div>
      </div>
      <span class="sub-title">
        {{ 'advanced option' | translate }}
      </span>
      <mat-checkbox class="checkbox-margin" (click)="toggleAdvancedMenu()">
        {{ 'escrow transaction' | translate }}
      </mat-checkbox>
      <div class="zbc-form-item" *ngIf="advancedMenu">
        <input-address
          label="{{ 'approver address' | translate }}"
          classList="block"
          formControlName="addressApprover"
          placeholder="{{ 'approver address' | translate }}..."
        ></input-address>
        <ng-container *ngIf="addressApproverField.touched">
          <mat-error *ngIf="addressApproverField.hasError('required')">
            {{ 'address for approver is required' | translate }}
          </mat-error>
          <mat-error *ngIf="addressApproverField.hasError('invalidAddress')">
            {{ 'zbc address is invalid' | translate }}
          </mat-error>
        </ng-container>
        <input-amount
          [group]="formSend"
          typeCoinName="typeCommission"
          amountCurrencyName="approverCommissionCurr"
          amountName="approverCommission"
          [displayConverter]="false"
          [currencyRate]="currencyRate"
          label="{{ 'approver commission' | translate }}"
        >
        </input-amount>
        <div class="row">
          <div class="col-4 col-sm-3">&nbsp;</div>
          <div class="col-8 col-sm-9">
            <ng-container *ngIf="approverCommissionField.touched && typeCommissionField.value === 'ZBC'">
              <mat-error *ngIf="approverCommissionField.hasError('required')">
                {{ 'commission for approver is required' | translate }}
              </mat-error>
              <mat-error *ngIf="approverCommissionField.hasError('min')">
                {{ 'minimum commission is' | translate: { val: '0.00000001' } }}
              </mat-error>
            </ng-container>

            <ng-container *ngIf="approverCommissionCurrField.touched && typeCommissionField.value === 'Fiat'">
              <mat-error *ngIf="approverCommissionCurrField.hasError('required')">
                {{ 'commission for approver is required' | translate }}
              </mat-error>
              <mat-error *ngIf="approverCommissionCurrField.hasError('min')">
                {{ 'minimum commission for approver in zbc must be zbc' | translate: { val: '0.00000001' } }}
              </mat-error>
            </ng-container>
          </div>
        </div>
        <label class="block-height"
          ><b>{{ 'block height' | translate }} : {{ blockHeight | number }}</b></label
        >

        <mat-form-field appearance="outline" class="block" color="accent">
          <mat-label>{{ 'timeout' | translate }}</mat-label>
          <input
            (change)="onChangeTimeOut()"
            matInput
            type="number"
            formControlName="timeout"
            placeholder="{{ 'timeout' | translate }}"
          />
        </mat-form-field>
        <ng-container *ngIf="timeoutField.touched">
          <mat-error *ngIf="timeoutField.hasError('required')">{{
            'timeout is required' | translate
          }}</mat-error>
          <mat-error *ngIf="timeoutField.hasError('min')">
            {{ 'minimum timeout is 1' | translate }}
          </mat-error>
          <mat-error *ngIf="timeoutField.hasError('max')">
            {{ 'maximum timeout is 720' | translate }}
          </mat-error>
        </ng-container>
        <mat-form-field appearance="outline" class="block" color="accent">
          <mat-label>{{ 'instruction' | translate }}</mat-label>
          <textarea matInput formControlName="instruction" rows="5"></textarea>
        </mat-form-field>
        <ng-container *ngIf="instructionField.touched">
          <mat-error *ngIf="instructionField.hasError('required')">
            {{ 'instruction is required' | translate }}
          </mat-error>
        </ng-container>
      </div>

      <button
        mat-flat-button
        color="primary"
        type="submit"
        class="block button-margin"
        [disabled]="formSend.invalid || isLoading || isError"
      >
        <span *ngIf="isLoading"> <i class="fas fa-circle-notch fa-spin"></i>&nbsp; </span>
        <span>{{ 'send' | translate }}</span>
      </button>
    </form>
  </mat-card>
</div>
