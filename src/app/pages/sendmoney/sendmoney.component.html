<div class="sendmoney-container">
  <h2 class="mat-h2">{{ 'Send Money' | translate }}</h2>
  <mat-card>
    <form [formGroup]="formSend" (submit)="onOpenDialogDetailSendMoney()">
      <label>{{ 'From' | translate }}</label>
      <account-selector (select)="onSwitchAccount($event)"></account-selector>

      <label>{{ 'Recepient address' | translate }}</label>
      <mat-form-field appearance="outline" class="block" color="accent">
        <input
          matInput
          placeholder="{{ 'Recepient address' | translate }}..."
          aria-label="contacts"
          [matAutocomplete]="auto"
          formControlName="recipient"
          (keyup)="onChangeRecipient()"
          (blur)="isAddressInContacts()"
        />
        <mat-autocomplete #auto="matAutocomplete">
          <mat-option disabled>
            <span class="mat-caption">
              {{
                'Search address from your address book or your own account'
                  | translate
              }}
            </span>
          </mat-option>
          <mat-option
            *ngFor="let contact of filteredContacts | async"
            [value]="contact.address"
          >
            <span>{{ contact.alias }}</span> |
            <small>{{ contact.address }}</small>
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>
      <ng-container *ngIf="recipientForm.touched">
        <mat-error *ngIf="recipientForm.hasError('required')">
          {{ 'Recepient is required' | translate }}
        </mat-error>
        <mat-error *ngIf="recipientForm.hasError('invalidAddress')">
          {{ 'ZBC Address is invalid' | translate }}
        </mat-error>
      </ng-container>
      <div class="address-alias" *ngIf="!showSaveAddressBtn">
        <span>{{ 'Address' | translate }}: </span>
        <b>{{ contact.alias }}</b>
      </div>
      <div style="margin-bottom: 8px;" *ngIf="showSaveAddressBtn">
        <mat-checkbox class="checkbox-margin" (change)="toggleSaveAddress()">
          {{ 'Save to Address Book' | translate }}
        </mat-checkbox>
      </div>

      <ng-container *ngIf="saveAddress">
        <label>{{ 'Alias' | translate }}</label>
        <mat-form-field appearance="outline" color="accent" class="block">
          <input
            matInput
            type="text"
            formControlName="alias"
            placeholder="{{ 'Alias' | translate }}"
          />
        </mat-form-field>
        <ng-container *ngIf="aliasField.touched">
          <mat-error *ngIf="aliasField.hasError('required')">
            {{ 'Alias is required' | translate }}
          </mat-error>
        </ng-container>
      </ng-container>

      <div class="zbc-form-item">
        <div class="amount text-right">
          <div class="primary-amount">
            {{ amountForm.value | number: '0.0-8' }} ZBC
          </div>
          <div class="secondary-amount">
            {{ amountCurrencyForm.value | number: '0.0-2' }}
            {{ currencyRate.name }}
          </div>
        </div>
      </div>

      <label>{{ 'Coin amount' | translate }}</label>
      <div class="row">
        <div class="col-4 col-sm-3">
          <mat-form-field appearance="outline" color="accent" class="block">
            <mat-select [(value)]="typeCoin">
              <mat-option value="ZBC">ZBC</mat-option>
              <mat-option value="Fiat">{{ currencyRate.name }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="col-8 col-sm-9">
          <mat-form-field
            appearance="outline"
            class="block"
            *ngIf="typeCoin === 'ZBC'"
            color="accent"
          >
            <input
              matInput
              type="number"
              formControlName="amount"
              placeholder="{{ 'Coin Amount' | translate }}"
              (change)="onChangeAmountField()"
              (keyup)="onChangeAmountField()"
            />
          </mat-form-field>
          <ng-container *ngIf="amountForm.touched && typeCoin === 'ZBC'">
            <mat-error *ngIf="amountForm.hasError('required')">
              {{ 'Amount is required' | translate }}
            </mat-error>
            <mat-error *ngIf="amountForm.hasError('min')">
              {{ 'Minimum amount is' | translate: { val: '0.00000001' } }}
            </mat-error>
          </ng-container>
          <mat-form-field
            *ngIf="typeCoin === 'Fiat'"
            appearance="outline"
            class="block"
            color="accent"
          >
            <input
              matInput
              type="number"
              formControlName="amountCurrency"
              placeholder="{{ currencyRate.name }} {{ 'amount' | translate }}"
              (change)="onChangeAmountCurrencyField()"
              (keyup)="onChangeAmountCurrencyField()"
            />
          </mat-form-field>
          <ng-container
            *ngIf="amountCurrencyForm.touched && typeCoin === 'Fiat'"
          >
            <mat-error *ngIf="amountCurrencyForm.hasError('required')">
              {{ 'Amount is required' | translate }}
            </mat-error>
            <mat-error *ngIf="amountCurrencyForm.hasError('min')">
              {{
                'Minimum amount in ZBC must be ZBC'
                  | translate: { val: '0.00000001' }
              }}
            </mat-error>
          </ng-container>
        </div>
      </div>

      <label>{{ 'Fee' | translate }}</label>
      <div class="choose-fee">
        <button
          mat-flat-button
          type="button"
          [disabled]="customFee"
          (click)="onFeeChoose(1)"
          [class.fee-choosen]="activeButton === 1"
        >
          <div class="fee-button">
            <div class="label">{{ 'Slow' | translate }}</div>
            <div class="zbc-currency">{{ feeSlow }} ZBC</div>
            <div class="fiat-currency">
              {{ feeSlow * currencyRate.value | number: '0.0-2' }}
              {{ currencyRate.name }}
            </div>
          </div>
        </button>
        <button
          mat-flat-button
          type="button"
          [disabled]="customFee"
          (click)="onFeeChoose(2)"
          [class.fee-choosen]="activeButton === 2"
        >
          <div class="fee-button">
            <div class="label">{{ 'Average' | translate }}</div>
            <div class="zbc-currency">{{ feeMedium }} ZBC</div>
            <div class="fiat-currency">
              {{ feeMedium * currencyRate.value | number: '0.0-2' }}
              {{ currencyRate.name }}
            </div>
          </div>
        </button>
        <button
          mat-flat-button
          type="button"
          [disabled]="customFee"
          (click)="onFeeChoose(3)"
          [class.fee-choosen]="activeButton === 3"
        >
          <div class="fee-button">
            <div class="label">{{ 'Fast' | translate }}</div>
            <div class="zbc-currency">{{ feeFast }} ZBC</div>
            <div class="fiat-currency">
              {{ feeFast * currencyRate.value | number: '0.0-2' }}
              {{ currencyRate.name }}
            </div>
          </div>
        </button>
      </div>
      <div style="margin-bottom: 8px;">
        <mat-checkbox class="checkbox-margin" (click)="toggleCustomFee()">
          {{ 'Custom Fee' | translate }}
        </mat-checkbox>
      </div>

      <div class="zbc-form-item" *ngIf="customFee">
        <div class="amount text-right">
          <div class="primary-amount">
            {{ feeForm.value | number: '0.0-8' }} ZBC
          </div>
          <div class="secondary-amount">
            {{ feeFormCurr.value | number: '0.0-2' }} {{ currencyRate.name }}
          </div>
        </div>
        <label>{{ 'Custom Fee' | translate }}</label>
        <div class="row">
          <div class="col-4 col-sm-3">
            <mat-form-field appearance="outline" color="accent" class="block">
              <mat-select [(value)]="typeFee">
                <mat-option value="ZBC">ZBC</mat-option>
                <mat-option value="Fiat">{{ currencyRate.name }}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="col-8 col-sm-9">
            <mat-form-field
              appearance="outline"
              class="block"
              *ngIf="typeFee === 'ZBC'"
              color="accent"
            >
              <input
                matInput
                type="number"
                formControlName="fee"
                placeholder="{{ 'Fee' | translate }}"
                (change)="onChangeFeeField()"
                (keyup)="onChangeFeeField()"
              />
            </mat-form-field>
            <ng-container *ngIf="feeForm.touched && typeFee === 'ZBC'">
              <mat-error *ngIf="feeForm.hasError('required')">
                {{ 'Fee is required' | translate }}
              </mat-error>
              <mat-error *ngIf="feeForm.hasError('min')">
                {{ 'Minimum fee is' | translate: { val: '0.00000001' } }}
              </mat-error>
            </ng-container>
            <mat-form-field
              appearance="outline"
              class="block"
              *ngIf="typeFee === 'Fiat'"
              color="accent"
            >
              <input
                matInput
                type="number"
                formControlName="feeCurr"
                placeholder="{{ 'Fee' | translate }}"
                (change)="onChangeFeeCurrencyField()"
                (keyup)="onChangeFeeCurrencyField()"
              />
            </mat-form-field>
            <ng-container *ngIf="feeFormCurr.touched && typeFee === 'Fiat'">
              <mat-error *ngIf="feeFormCurr.hasError('required')">
                {{ 'Fee is required' | translate }}
              </mat-error>
              <mat-error *ngIf="feeFormCurr.hasError('min')">
                {{
                  'Minimum amount of fee in ZBC must be ZBC'
                    | translate: { val: '0.00000001' }
                }}
              </mat-error>
            </ng-container>
          </div>
        </div>
      </div>

      <span class="sub-title" (click)="toggleAdvancedMenu()">
        {{ 'Advanced' | translate }}&nbsp;<i>({{ 'Coming Soon' | translate }})</i>
        <i class="fa fa-caret-down icon-dropdown"></i>
      </span>

      <div class="zbc-form-item" *ngIf="advancedMenu">
        <label>{{ 'Approver Address' | translate }}</label>
        <div class="row">
          <mat-form-field appearance="outline" class="block" color="accent">
            <input
              matInput
              placeholder="{{ 'Approver Address' | translate }}..."
              aria-label="contacts"
              [matAutocomplete]="auto"
              formControlName="addressApprover"
              (keyup)="onChangeAddressApprover()"
              (blur)="isAddressInContacts()"
            />
            <mat-autocomplete #auto="matAutocomplete">
              <mat-option disabled>
                <span class="mat-caption">
                  {{
                    'Search address from your address book or your own account'
                      | translate
                  }}
                </span>
              </mat-option>
              <mat-option
                *ngFor="let contact of filteredContacts | async"
                [value]="contact.address"
              >
                <span>{{ contact.alias }}</span> |
                <small>{{ contact.address }}</small>
              </mat-option>
            </mat-autocomplete>
          </mat-form-field>
          <ng-container *ngIf="addressApproverField.touched">
            <mat-error *ngIf="addressApproverField.hasError('required')">
              {{ 'Address for Approver is required' | translate }}
            </mat-error>
            <mat-error *ngIf="addressApproverField.hasError('invalidAddress')">
              {{ 'ZBC Address is invalid' | translate }}
            </mat-error>
          </ng-container>
        </div>
        <label>{{ 'Approver Commission' | translate }}</label>
        <div class="row">
          <div class="col-4 col-sm-3">
            <mat-form-field appearance="outline" color="accent" class="block">
              <mat-select [(value)]="typeCommission">
                <mat-option value="ZBC">ZBC</mat-option>
                <mat-option value="Fiat">{{ currencyRate.name }}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="col-8 col-sm-9">
            <mat-form-field
              appearance="outline"
              class="block"
              *ngIf="typeCommission === 'ZBC'"
              color="accent"
            >
              <input
                matInput
                type="number"
                formControlName="approverCommission"
                placeholder="{{ 'Approver Commission' | translate }}"
                (change)="onChangeCommisssionField()"
                (keyup)="onChangeCommisssionField()"
              />
            </mat-form-field>
            <ng-container
              *ngIf="
                approverCommissionField.touched && typeCommission === 'ZBC'
              "
            >
              <mat-error *ngIf="approverCommissionField.hasError('required')">
                {{ 'Commission for approver is required' | translate }}
              </mat-error>
              <mat-error *ngIf="approverCommissionField.hasError('min')">
                {{ 'Minimum commission is' | translate: { val: '0.00000001' } }}
              </mat-error>
            </ng-container>
            <mat-form-field
              appearance="outline"
              class="block"
              *ngIf="typeCommission === 'Fiat'"
              color="accent"
            >
              <input
                matInput
                type="number"
                formControlName="approverCommissionCurr"
                placeholder="{{ 'Commission Currency' | translate }}"
                (change)="onChangeCommisssionCurrField()"
                (keyup)="onChangeCommisssionCurrField()"
              />
            </mat-form-field>
            <ng-container
              *ngIf="
                approverCommissionCurrField.touched && typeCommission === 'Fiat'
              "
            >
              <mat-error
                *ngIf="approverCommissionCurrField.hasError('required')"
              >
                {{ 'Commission for approver is required' | translate }}
              </mat-error>
              <mat-error *ngIf="approverCommissionCurrField.hasError('min')">
                {{
                  'Minimum Commission for approver in ZBC must be ZBC'
                    | translate: { val: '0.00000001' }
                }}
              </mat-error>
            </ng-container>
          </div>
        </div>
        <label>{{ 'Timeout' | translate }}</label>
        <mat-form-field appearance="outline" class="block" color="accent">
          <input
            matInput
            [min]="minDate"
            [max]="maxDate"
            [owlDateTime]="dt8"
            [formControl]="timeoutField"
            [owlDateTimeTrigger]="dt8"
          />
          <owl-date-time #dt8></owl-date-time>
        </mat-form-field>
        <ng-container *ngIf="timeoutField.touched">
          <mat-error *ngIf="timeoutField.hasError('required')">{{
            'Timeout is required' | translate
          }}</mat-error>
        </ng-container>
        <label>{{ 'Instruction' | translate }}</label>
        <mat-form-field appearance="outline" class="block" color="accent">
          <textarea
            matInput
            placeholder="Textarea"
            formControlName="instruction"
            rows="5"
          ></textarea>
        </mat-form-field>
        <ng-container *ngIf="instructionField.touched">
          <mat-error *ngIf="instructionField.hasError('required')">
            {{ 'Instruction is required' | translate }}
          </mat-error>
        </ng-container>
      </div>

      <button
        mat-flat-button
        color="primary"
        type="submit"
        class="block"
        [disabled]="formSend.invalid || isLoading || isError"
      >
        <span *ngIf="isLoading">
          <i class="fas fa-circle-notch fa-spin"></i>&nbsp;
        </span>
        <span>{{ 'Send' | translate }}</span>
      </button>
    </form>
  </mat-card>
</div>

<ng-template #popupDetailSendMoney>
  <div class="confirmation-dialog">
    <div class="row">
      <div class="col-12 col-sm-6">
        <div class="title">{{ 'Confirm Send Money' | translate }}</div>
      </div>
      <div class="col-12 col-sm-6 text-right">
        <a class="brand">
          <div class="title-wallet">
            <p class="text">ZooBC Wallet</p>
            <img src="../../../assets/img/zbc-color.svg" alt="" />
          </div>
        </a>
      </div>
    </div>
    <mat-divider></mat-divider>
    <div class="content">
      <div class="row">
        <div class="col-12 col-sm-6 test">
          <div class="label">{{ 'From' | translate }}:</div>
          <div class="address">
            <wallet-address
              [value]="account.address"
              [copyButton]="true"
            ></wallet-address>
          </div>
          <div class="label">{{ 'Recepient' | translate }}:</div>
          <div class="address">
            <wallet-address
              [value]="recipientForm.value"
              [copyButton]="true"
            ></wallet-address>
          </div>
        </div>
        <div class="col-12 col-sm-6 text-right">
          <div class="label">{{ 'Amount' | translate }}:</div>
          <div class="amount">
            <div class="zbc">{{ amountForm.value | number: '0.0-8' }} ZBC</div>
            <div class="currency">
              {{ amountCurrencyForm.value | number: '0.0-2' }}
              {{ currencyRate.name }}
            </div>
          </div>
          <div class="label">
            <span>Fee</span>
            <span *ngIf="!customFee"> - {{ kindFee }}</span>
            <span>:</span>
          </div>
          <div class="amount">
            <div class="zbc">{{ feeForm.value | number: '0.0-8' }} ZBC</div>
            <div class="currency">
              {{ feeFormCurr.value | number: '0.0-2' }} {{ currencyRate.name }}
            </div>
          </div>
          <div class="label">{{ 'Total' | translate }} :</div>
          <div class="total">
            <div class="zbc">
              {{ amountForm.value + feeForm.value | number: '0.0-8' }} ZBC
            </div>
            <div class="currency">
              {{
                amountCurrencyForm.value + feeFormCurr.value | number: '0.0-2'
              }}
              {{ currencyRate.name }}
            </div>
          </div>
        </div>
      </div>
    </div>
    <mat-divider></mat-divider>

    <div class="text-right" style="margin-top: 8px">
      <button
        mat-flat-button
        color="warn"
        (click)="closeDialog()"
        style="margin-right: 8px"
      >
        {{ 'Cancel' | translate }}
      </button>
      <button mat-flat-button color="primary" (click)="onOpenPinDialog()">
        {{ 'Confirm' | translate }}
      </button>
    </div>
  </div>
</ng-template>
