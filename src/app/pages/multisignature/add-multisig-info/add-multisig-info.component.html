<div class="add-multisig-info-container">
  <h2 class="mat-h2">{{ 'Send Money' | translate }}</h2>
  <mat-card>
    <div class="stepper">
      <div class="step active">
        <span class="step-circle">1</span>
        <span class="step-label">Add Multisig Info</span>
      </div>
      <div class="stepper-line"></div>
      <div class="step">
        <span class="step-circle">2</span>
        <span class="step-label">Create Transaction</span>
      </div>
      <div class="stepper-line"></div>
      <div class="step">
        <span class="step-circle">3</span>
        <span class="step-label">Add Signatures</span>
      </div>
    </div>
    <mat-divider style="margin-bottom: 24px;"></mat-divider>

    <form [formGroup]="form" (submit)="next()">
      <account-selector
        (select)="onSwitchAccount($event)"
        type="multisig"
        [switchAccount]="false"
        *ngIf="!isMultiSignature"
      >
        <button mat-flat-button color="primary" class="block" type="button" style="margin-bottom: 16px;">
          {{ 'Import My Multisignature Account' | translate }}
        </button>
      </account-selector>

      <label>{{ 'Participants' }}</label>
      <div formArrayName="participants" style="margin-bottom: 8px;">
        <ng-container *ngFor="let participant of participantsField.controls; let i = index">
          <div class="inline-control">
            <input-address
              style="width: 100%;"
              label=""
              classList="custom-mat"
              [formControlName]="i"
              placeholder="{{ 'Participant ' }} {{ i + 1 }}..."
              [readonly]="this.isMultiSignature"
            >
            </input-address>
            <button
              (click)="removeParticipant(i)"
              type="button"
              mat-flat-button
              color="warn"
              *ngIf="!this.isMultiSignature && i > 1"
            >
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <ng-container *ngIf="participantsField.controls[i].touched">
            <mat-error *ngIf="participantsField.controls[i].hasError('required')">
              {{ 'Participant is required' }}
            </mat-error>
            <mat-error *ngIf="participantsField.controls[i].hasError('invalidAddress')">
              {{ 'Participant Address is invalid' }}
            </mat-error>
          </ng-container>
        </ng-container>
      </div>

      <div class="text-right" *ngIf="!isMultiSignature">
        <button (click)="addParticipant()" mat-flat-button class="small" color="primary" type="button">
          {{ 'Add Participants' }}
        </button>
      </div>
      <ng-container *ngIf="participantsField.touched">
        <mat-error class="center-error" *ngIf="participantsField.hasError('duplicate')">
          {{ 'Participant must be unique' }}
        </mat-error>
      </ng-container>

      <label>{{ 'Nonce' }}</label>
      <mat-form-field appearance="outline" color="accent" class="block">
        <input formControlName="nonce" matInput type="number" [readonly]="this.isMultiSignature" />
      </mat-form-field>
      <ng-container *ngIf="nonceField.touched">
        <mat-error *ngIf="nonceField.hasError('required')">
          {{ 'Nonce is required' }}
        </mat-error>
        <mat-error *ngIf="nonceField.hasError('min')">
          {{ 'Minimum Nonce is 1' }}
        </mat-error>
      </ng-container>

      <label>{{ 'Minimum Signature' }}</label>
      <mat-form-field appearance="outline" color="accent" class="block">
        <input formControlName="minSigs" matInput type="number" [readonly]="this.isMultiSignature" />
      </mat-form-field>
      <ng-container *ngIf="minSignatureField.touched">
        <mat-error *ngIf="minSignatureField.hasError('required')">
          {{ 'Minimum Signature is required' }}
        </mat-error>
        <mat-error *ngIf="minSignatureField.hasError('min')">
          {{ 'Minimum Signature is 2' }}
        </mat-error>
      </ng-container>

      <div class="row" style="margin-top: 10px;">
        <div class="col">
          <button mat-flat-button color="warn" class="block" type="button" (click)="back()">
            {{ 'Back' | translate }}
          </button>
        </div>
        <div class="col">
          <button
            mat-flat-button
            color="primary"
            class="block"
            [disabled]="!form.valid"
            type="button"
            (click)="saveDraft()"
          >
            {{ 'Save to draft' | translate }}
          </button>
        </div>
        <div class="col">
          <button mat-flat-button color="primary" class="block" [disabled]="!form.valid">
            {{ 'Next' | translate }}
          </button>
        </div>
      </div>
    </form>
  </mat-card>
</div>
