<div class="escrow-list-container">
  <ng-container *ngIf="escrowTransactionsData">
    <div class="no-content padding" *ngIf="escrowTransactionsData.length <= 0">
      <i matPrefix class="fa fa-receipt"></i>
      <span class="message">{{ 'no approval needed' | translate }}</span>
    </div>
    <div
      [className]="withDetail ? 'escrow-item hover row' : 'escrow-item hover'"
      *ngFor="let escrow of escrowTransactionsData; let i = index"
      (click)="openDetail(escrow.id)"
    >
      <div class="col-12 col-sm-8">
        <div class="title-task">
          {{ 'sender' | translate }}: <br />
          <wallet-address class="address" [value]="escrow.senderaddress"></wallet-address>
        </div>
        <div class="title-task">
          {{ 'recipient' | translate }}: <br />
          <wallet-address class="address" [value]="escrow.recipientaddress"></wallet-address>
        </div>
        <div class="timeout">
          {{ 'expired after block height' | translate }} : {{ escrow.timeout + escrow.blockheight | number }}
        </div>
      </div>
      <div class="col-12 col-sm-4 text-right">
        <div class="nominal-task">
          {{ 'amount' | translate }}
        </div>
        <div class="commission-receive">{{ escrow.commission / 1e8 | number: '0.0-8' }} ZBC</div>
      </div>
    </div>
  </ng-container>

  <ng-container *ngIf="isLoading">
    <div class="escrow-item row skeleton" *ngFor="let i of [0, 1, 2, 3, 4, 5]">
      <div class="col-7 col-sm-8">
        <div class="skeleton-text" style="width:50%;"></div>
        <div class="skeleton-text small" style="width:75%;"></div>
        <div class="skeleton-text small" style="width:25%;"></div>
      </div>
      <div class="col-5 col-sm-4">
        <div class="skeleton-text" style="width:71%;float:right"></div>
        <div class="skeleton-text small" style="width:80%;float:right"></div>
      </div>
    </div>
  </ng-container>

  <div class="no-content padding" *ngIf="isError">
    <i matPrefix class="fa fa-exclamation-triangle"></i>
    <span class="message">
      {{ 'an error occurred while processing your request' | translate }}
    </span>
    <button mat-flat-button color="primary" (click)="onRefresh()">
      {{ 'try again' | translate }}
    </button>
  </div>
</div>

<ng-template #detailEscrow>
  <div class="detail-task-container" *ngIf="escrowDetail && !isLoadingDetail">
    <div class="row">
      <div class="col-12 col-md-4">{{ 'id' | translate }}:</div>
      <div class="col-12 col-md-8">{{ escrowDetail.id }}</div>
    </div>
    <div class="row">
      <div class="col-12 col-md-4">{{ 'sender' | translate }}:</div>
      <div class="col-12 col-md-8">
        <wallet-address [value]="escrowDetail.senderaddress"></wallet-address>
      </div>
    </div>
    <div class="row">
      <div class="col-12 col-md-4">{{ 'recipient' | translate }}:</div>
      <div class="col-12 col-md-8">
        <wallet-address [value]="escrowDetail.recipientaddress"></wallet-address>
      </div>
    </div>
    <div class="row">
      <div class="col-12 col-md-4">{{ 'amount' | translate }}:</div>
      <div class="col-12 col-md-8">{{ escrowDetail.amount / 1e8 | number: '0.0-8' }} ZBC</div>
    </div>
    <div class="row">
      <div class="col-12 col-md-4">{{ 'commission fee' | translate }}:</div>
      <div class="col-12 col-md-8">{{ escrowDetail.commission / 1e8 | number: '0.0-8' }} ZBC</div>
    </div>
    <div class="row">
      <div class="col-12 col-md-4">{{ 'instruction' | translate }}:</div>
      <div class="col-12 col-md-8">
        {{ escrowDetail.instruction }}
      </div>
    </div>
    <div class="row">
      <div class="col-12" style="margin: 16px 0;">
        <mat-checkbox (click)="toogleShowProcessForm($event)">
          {{ 'process this transaction' || translate }}
        </mat-checkbox>
      </div>
    </div>
    <ng-container *ngIf="showProcessForm">
      <div class="row" style="border-bottom: none;">
        <div class="col-12 col-md-10 offset-md-1">
          <input-amount
            [group]="form"
            typeCoinName="typeFee"
            amountCurrencyName="feeCurr"
            amountName="fee"
            [displayConverter]="true"
            [currencyRate]="currencyRate"
            label="{{ 'fee' | translate }}"
          >
          </input-amount>
        </div>
      </div>
      <div
        class="row"
        *ngIf="(feeForm.touched && feeForm.invalid) || (feeFormCurr.touched && feeFormCurr.invalid)"
      >
        <div class="col-12 col-md-10 offset-md-1">
          <div class="row" style="border-bottom: none; margin-top: -30px; font-weight: initial;">
            <div class="col-4 col-sm-3">&nbsp;</div>
            <div class="col-8 col-sm-9" style="padding: 0 10px;">
              <ng-container *ngIf="feeForm.touched && typeFeeField.value === 'ZBC'">
                <mat-error *ngIf="feeForm.hasError('required')">
                  {{ 'fee is required' | translate }}
                </mat-error>
                <mat-error *ngIf="feeForm.hasError('min')">
                  {{ 'minimum fee is' | translate: { val: minFee } }}
                </mat-error>
              </ng-container>
              <ng-container *ngIf="feeFormCurr.touched && typeFeeField.value === 'Fiat'">
                <mat-error *ngIf="feeFormCurr.hasError('required')">
                  {{ 'fee is required' | translate }}
                </mat-error>
                <mat-error *ngIf="feeFormCurr.hasError('min')">
                  {{ 'minimum amount of fee in zbc must be zbc' | translate: { val: minFee } }}
                </mat-error>
              </ng-container>
            </div>
          </div>
        </div>
      </div>
      <div class="text-right" style="margin-top: 8px">
        <button [disabled]="isLoadingTx" mat-button style="margin-right: 8px" (click)="closeDialog()">
          {{ 'cancel' | translate }}
        </button>
        <button
          [disabled]="isLoadingTx || !form.valid"
          mat-flat-button
          color="warn"
          style="margin-right: 8px"
          (click)="onOpenPinDialog(escrowDetail.id, 1)"
        >
          <span *ngIf="isLoadingTx"> <i class="fas fa-circle-notch fa-spin"></i>&nbsp;</span>
          <span>{{ 'reject' | translate }}</span>
        </button>
        <button
          [disabled]="isLoadingTx || !form.valid"
          mat-flat-button
          color="primary"
          (click)="onOpenPinDialog(escrowDetail.id, 0)"
        >
          <span *ngIf="isLoadingTx"> <i class="fas fa-circle-notch fa-spin"></i>&nbsp; </span>
          <span>
            {{ 'confirm' | translate }}
          </span>
        </button>
      </div>
    </ng-container>
  </div>

  <div class="detail-task-container skeleton" *ngIf="isLoadingDetail">
    <div class="row">
      <div class="col-12 col-md-4">
        <div class="skeleton-text" style="width:20%;"></div>
      </div>
      <div class="col-12 col-md-8">
        <div class="skeleton-text" style="width:50%;"></div>
      </div>
    </div>

    <div class="row">
      <div class="col-12 col-md-4">
        <div class="skeleton-text" style="width:50%;"></div>
      </div>
      <div class="col-12 col-md-8">
        <div class="skeleton-text" style="width:100%;"></div>
      </div>
    </div>

    <div class="row">
      <div class="col-12 col-md-4">
        <div class="skeleton-text" style="width:30%;"></div>
      </div>
      <div class="col-12 col-md-8">
        <div class="skeleton-text" style="width:30%;"></div>
      </div>
    </div>

    <div class="row">
      <div class="col-12 col-md-4">
        <div class="skeleton-text" style="width:50%;"></div>
      </div>
      <div class="col-12 col-md-8">
        <div class="skeleton-text" style="width:30%;"></div>
      </div>
    </div>

    <div class="row">
      <div class="col-12 col-md-4">
        <div class="skeleton-text" style="width:70%;"></div>
      </div>
      <div class="col-12 col-md-8">
        <div class="skeleton-text" style="width:40%;"></div>
      </div>
    </div>

    <div class="row">
      <div class="col-12 col-md-4">
        <div class="skeleton-text" style="width:40%;"></div>
      </div>
      <div class="col-12 col-md-8">
        <div class="skeleton-text" style="width:100%;"></div>
      </div>
    </div>
  </div>
</ng-template>
